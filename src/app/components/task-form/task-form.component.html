<form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
  <div>
    <input formControlName="title" placeholder="Task title">
    <div *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
      <small *ngIf="taskForm.get('title')?.errors?.['required']">Title is required.</small>
      <small *ngIf="taskForm.get('title')?.errors?.['minlength']">Title must be at least 5 characters long.</small>
    </div>
  </div>

  <div>
    <input formControlName="dueDate" type="date">
    <div *ngIf="taskForm.get('dueDate')?.invalid && taskForm.get('dueDate')?.touched">
      <small *ngIf="taskForm.get('dueDate')?.errors?.['required']">Due date is required.</small>
    </div>
  </div>
  
  <div formArrayName="persons">
    <div *ngFor="let person of persons.controls; let i = index" [formGroupName]="i">
      <div>
        <input formControlName="fullName" placeholder="Full name">
        <div *ngIf="person.get('fullName')?.invalid && person.get('fullName')?.touched">
          <small *ngIf="person.get('fullName')?.errors?.['required']">Full name is required.</small>
          <small *ngIf="person.get('fullName')?.errors?.['minlength']">Full name must be at least 5 characters long.</small>
          <small *ngIf="person.get('fullName')?.errors?.['duplicateName']">This name already exists in the task.</small>
        </div>
      </div>

      <div>
        <input formControlName="age" type="number" placeholder="Age">
        <div *ngIf="person.get('age')?.invalid && person.get('age')?.touched">
          <small *ngIf="person.get('age')?.errors?.['required']">Age is required.</small>
          <small *ngIf="person.get('age')?.errors?.['min']">Age must be at least 18.</small>
        </div>
      </div>
      
      <div formArrayName="skills">
        <div *ngFor="let skill of personSkills(i).controls; let j = index">
          <input [formControlName]="j" placeholder="Skill">
          <button type="button" (click)="removeSkill(i, j)">Remove Skill</button>
        </div>
        <div *ngIf="personSkills(i).invalid && personSkills(i).touched">
          <small *ngIf="personSkills(i).errors?.['required']">At least one skill is required.</small>
        </div>
        <button type="button" (click)="addSkill(i)">Add Skill</button>
      </div>
      
      <button type="button" (click)="removePerson(i)">Remove Person</button>
    </div>
    <button type="button" (click)="addPerson()">Add Person</button>
  </div>
  
  <button type="submit" [disabled]="taskForm.invalid">Create Task</button>
</form>